---
layout: post
title: "Analisis de productividad sectorial y regional con Encuesta ELE 1-4"
author: "Fernando Greve"
date: "March 30, 2017"
categories: blog
---





{% highlight r %}

library(markdown) #genera reporte
library(ggplot2) #graphs
library(gcookbook) #install.packages("gcookbook")
library(matrixStats) #install.packages("matrixStats")
library(plotrix) #weighted histograms
library(questionr) #weighted table(frequency)
library(foreign) #Importar datos en cualquier formato (STATA old version .dta)
library(reshape2)
library(DT)

#get ELE4
setwd("C:/Users/fgreve/Dropbox/CNP/ELE")
#ELE4 = read.csv(file="BBDD ELE4.csv", header=TRUE, sep=",", encoding="utf-8")
ELE1= read.dta("ELE1.dta")
ELE2= read.dta("ELE2.dta")
ELE3= read.dta("ELE3.dta")
ELE4= read.dta("ELE4.dta")
#head(ELE4)

#GEN VARIABLES###################################################################

#Valor UF en millones
UF2006 = 18162.40
UF2007 = 18789.30
UF2008 = 20429.09
UF2009 = 21007.40
UF2010 = 21171.80
UF2011 = 21846.38
UF2012 = 22598.85
UF2013 = 22980.90
UF2014 = 23960.60
UF2015 = 25022.00
  
#ELE1
ELE1$Y2006 <- ELE1$p27_1/10^3*UF2015/UF2006 #ventas anuales (M$)
ELE1$Y2007 <- ELE1$p27_2/10^3*UF2015/UF2007 #ventas anuales (M$)
ELE1$K2007 <- ELE1$p82_4/10^3 #valor activo fijo (M$)
ELE1$L2007 <- ELE1$p103_1_5_1 + ELE1$p103_1_5_2 #trab. total H + trab. total M
ELE1$FE_V <- ELE1$fe_venta
ELE1$FE_E <- ELE1$fe_empresa

#ELE2
ELE2$Y2008 <- ELE2$c3_30/10^6*UF2015/UF2008 #Total ingresos de explotacion ($) a (Dic 2008)
ELE2$Y2009 <- ELE2$c3_44/10^6*UF2015/UF2009 #Total ingresos de explotacion ($) a (Dic 2009)
ELE2$K2009 <- ELE2$c1_9/10^6 #Saldo contable($) Total activos fijos (Dic 2009)
ELE2$L2009 <- ELE2$h8_42 #Total trabajadores/as al año 2009
ELE2$FE_V <- ELE2$FE__Ventas
ELE2$FE_E <- ELE2$FE_Número_Empresas

#ELE3
ELE3$Y2012 <- ELE3$C001/10^2*UF2015/UF2012 #Ingresos por actividad principal de la empresa 2012 (Miles de $)
ELE3$Y2013 <- ELE3$C036/10^2*UF2015/UF2013 #Ingresos por actividad principal de la empresa 2013 (Miles de $)
ELE3$K2012 <- ELE3$C022/10^2 #Activos fijos (terrenos, edificios, maquinarias) 2012 (Miles de $)
ELE3$K2013 <- ELE3$C057/10^2 #Activos fijos (terrenos, edificios, maquinarias) 2013 (Miles de $)
ELE3$L2013 <- ELE3$I011 + ELE3$I018 #trab. total hombres + trab. total mujeres (2013)
ELE3$FE_V <- ELE3$FE_Ventas
ELE3$FE_E <- ELE3$FE_Empresa

#ELE4
#ELE4$Y2014 <- ELE4$C001/10^2*UF2015/UF2014 #Ingresos por actividad principal de la empresa 2014 (Miles de $)

ELE4$Y2014 <- (ELE4$C001-ELE4$C006)/10^2*UF2015/UF2014 #Ingresos por actividad principal de la empresa 2014 (Miles de $)

#ELE4$Y2015 <- ELE4$C037/10^2*UF2015/UF2015 #Ingresos por actividad principal de la empresa 2015 (Miles de $)

ELE4$Y2015 <- (ELE4$C037-ELE4$C042)/10^2*UF2015/UF2015 #Ingresos por actividad principal de la empresa 2014 (Miles de $)

ELE4$K2014 <- ELE4$C023/10^2 #Activos fijos (terrenos, edificios, maquinarias) 2014 (Miles de $)
ELE4$K2015 <- ELE4$C059/10^2 #Activos fijos (terrenos, edificios, maquinarias) 2015 (Miles de $)
ELE4$L2015 <- ELE4$I020 + ELE4$I021 #trab. total H + trab. total M 2015
ELE4$FE_V <- ELE4$FE_Ventas_ELE4
ELE4$FE_E <- ELE4$FE_Empresas_ELE4

#LIMPIA BASES###################################################################
#elimina observaciones con valores 0 en ventas o trabajadores

#ELE1
ELE1 <- subset(ELE1, ELE1$Y2007 !=0) #elimina obs con PIB=0
ELE1 <- subset(ELE1, ELE1$L2007 !=0) #elimina obs con L=0
summary(ELE1$Y2007)

#ELE2
ELE2 <- subset(ELE2, ELE2$Y2009 !=0) #elimina obs con PIB=0
ELE2 <- subset(ELE2, ELE2$L2009 !=0) #elimina obs con L=0
summary(ELE2$Y2009)

#ELE3
ELE3 <- subset(ELE3, ELE3$Y2013 !=0) #elimina obs con PIB=0
ELE3 <- subset(ELE3, ELE3$L2013 !=0) #elimina obs con L=0
summary(ELE3$Y2013)

#ELE4
ELE4 <- subset(ELE4, ELE4$Y2015 !=0) #elimina obs con PIB=0
ELE4 <- subset(ELE4, ELE4$L2015 !=0) #elimina obs con L=0
summary(ELE4$Y2015)

#GEN PRODUCTIVIDAD LABORAL########################################################

#ELE1
ELE1$LP <- ELE1$Y2007 / ELE1$L2007 #productividad laboral
summary(ELE1$LP) 

#ELE2
ELE2$LP <- ELE2$Y2009 / ELE2$L2009 #productividad laboral
summary(ELE2$LP) 

#ELE3
ELE3$LP <- ELE3$Y2013 / ELE3$L2013 #productividad laboral
summary(ELE3$LP) 

#ELE4
ELE4$LP <- ELE4$Y2015 / ELE4$L2015 #productividad laboral
summary(ELE4$LP)

#clasificacion sectorial ELE1
#A Agricultura, ganadería, caza y silvicultura.
#C Explotación de minas y canteras.
#D Industrias manufactureras.
#E Suministro de electricidad, gas y agua.
#F Construcción.
#G Comercio 
#H Hoteles y restaurantes.
#I Transporte, almacenamiento y comunicaciones.
#J Intermediación financiera.
#K Actividades inmobiliarias, empresariales y de alquiler.
#O Otras actividades de servicios comunitarios, sociales y personales.
ELE1_A <- subset(ELE1, subset=ELE1$categoria=="A")
ELE1_C <- subset(ELE1, subset=ELE1$categoria=="C")
ELE1_D <- subset(ELE1, subset=ELE1$categoria=="D")
ELE1_E <- subset(ELE1, subset=ELE1$categoria=="E")
ELE1_F <- subset(ELE1, subset=ELE1$categoria=="F")
ELE1_G <- subset(ELE1, subset=ELE1$categoria=="G")
ELE1_H <- subset(ELE1, subset=ELE1$categoria=="H")
ELE1_I <- subset(ELE1, subset=ELE1$categoria=="I")
ELE1_J <- subset(ELE1, subset=ELE1$categoria=="J")
ELE1_K <- subset(ELE1, subset=ELE1$categoria=="K")
ELE1_O <- subset(ELE1, subset=ELE1$categoria=="O")

#clasificacion sectorial ELE2
#A Agricultura, ganadería, caza y silvicultura.
#B Pesca
#C Explotación de minas y canteras.
#D Industrias manufactureras.
#E Suministro de electricidad, gas y agua.
#F Construcción.
#G Comercio al por mayor y por menor; reparación de vehículos automotores,
#motocicletas, efectos personales y enseres domésticos.
#H Hoteles y restaurantes.
#I Transporte, almacenamiento y comunicaciones.
#J Intermediación financiera.
#K Actividades inmobiliarias, empresariales y de alquiler.
#O Otras actividades de servicios comunitarios, sociales y personales.
ELE2_A <- subset(ELE2, subset=ELE2$Categoria=="A")
ELE2_C <- subset(ELE2, subset=ELE2$Categoria=="C")
ELE2_D <- subset(ELE2, subset=ELE2$Categoria=="D")
ELE2_E <- subset(ELE2, subset=ELE2$Categoria=="E")
ELE2_F <- subset(ELE2, subset=ELE2$Categoria=="F")
ELE2_G <- subset(ELE2, subset=ELE2$Categoria=="G")
ELE2_H <- subset(ELE2, subset=ELE2$Categoria=="H")
ELE2_I <- subset(ELE2, subset=ELE2$Categoria=="I")
ELE2_J <- subset(ELE2, subset=ELE2$Categoria=="J")
ELE2_K <- subset(ELE2, subset=ELE2$Categoria=="K")
ELE2_O <- subset(ELE2, subset=ELE2$Categoria=="O")

#clasificacion sectorial ELE3
#A Agricultura, ganadería, caza y silvicultura.
#B Pesca
#C Explotación de minas y canteras.
#D Industrias manufactureras.
#E Suministro de electricidad, gas y agua.
#F Construcción.
#G Comercio al por mayor y por menor; reparación de vehículos automotores,
#motocicletas, efectos personales y enseres domésticos.
#H Hoteles y restaurantes.
#I Transporte, almacenamiento y comunicaciones.
#J Intermediación financiera.
#K Actividades inmobiliarias, empresariales y de alquiler.
#O Otras actividades de servicios comunitarios, sociales y personales.
ELE3_A <- subset(ELE3, subset=ELE3$Categoria=="A")
ELE3_C <- subset(ELE3, subset=ELE3$Categoria=="C")
ELE3_D <- subset(ELE3, subset=ELE3$Categoria=="D")
ELE3_E <- subset(ELE3, subset=ELE3$Categoria=="E")
ELE3_F <- subset(ELE3, subset=ELE3$Categoria=="F")
ELE3_G <- subset(ELE3, subset=ELE3$Categoria=="G")
ELE3_H <- subset(ELE3, subset=ELE3$Categoria=="H")
ELE3_I <- subset(ELE3, subset=ELE3$Categoria=="I")
ELE3_J <- subset(ELE3, subset=ELE3$Categoria=="J")
ELE3_K <- subset(ELE3, subset=ELE3$Categoria=="K")
ELE3_O <- subset(ELE3, subset=ELE3$Categoria=="O")

#ELE4
#A Agricultura , Ganadería, Silvicultura y Pesca
#B Explotación de Minas y Canteras
#C Industrias Manufactureras
#X Suministro de Electricidad, Gas y Agua (Suministro de electricidad, gas, vapor y aire acondicionado - Suministro de agua; evacuación de aguas residuales, gestión de desechos y descontaminación)
#F Construcción
#G Comercio al por mayor y al por menor; reparación de vehículos automotores y motocicletas
#H Transporte y Almacenamiento
#I Actividades de alojamiento y de servicio de comidas
#J Información y Comunicaciones
#K Actividades financieras y de seguros
#M Actividades profesionales, científicas y técnicas
#Y Actividades de servicios (Actividades inmobiliarias - Actividades de servicios administrativos y de apoyo)
#Z Actividades artísticas, de entretenimiento y recreativas 
ELE4_A <- subset(ELE4, subset=ELE4$CIIUfinal_ELE4=="A")
ELE4_B <- subset(ELE4, subset=ELE4$CIIUfinal_ELE4=="B")
ELE4_C <- subset(ELE4, subset=ELE4$CIIUfinal_ELE4=="C")
ELE4_X <- subset(ELE4, subset=ELE4$CIIUfinal_ELE4=="X")
ELE4_F <- subset(ELE4, subset=ELE4$CIIUfinal_ELE4=="F")
ELE4_G <- subset(ELE4, subset=ELE4$CIIUfinal_ELE4=="G")
ELE4_H <- subset(ELE4, subset=ELE4$CIIUfinal_ELE4=="H")
ELE4_I <- subset(ELE4, subset=ELE4$CIIUfinal_ELE4=="I")
ELE4_J <- subset(ELE4, subset=ELE4$CIIUfinal_ELE4=="J")
ELE4_K <- subset(ELE4, subset=ELE4$CIIUfinal_ELE4=="K")
ELE4_M <- subset(ELE4, subset=ELE4$CIIUfinal_ELE4=="M")
ELE4_Y <- subset(ELE4, subset=ELE4$CIIUfinal_ELE4=="Y")
ELE4_Z <- subset(ELE4, subset=ELE4$CIIUfinal_ELE4=="Z")
#summary(ELE4_A$LP)

#region ELE4
ELE4_r01 <- subset(ELE4, subset=ELE4$Region_ELE4==1)
ELE4_r02 <- subset(ELE4, subset=ELE4$Region_ELE4==2)
ELE4_r03 <- subset(ELE4, subset=ELE4$Region_ELE4==3)
ELE4_r04 <- subset(ELE4, subset=ELE4$Region_ELE4==4)
ELE4_r05 <- subset(ELE4, subset=ELE4$Region_ELE4==5)
ELE4_r06 <- subset(ELE4, subset=ELE4$Region_ELE4==6)
ELE4_r07 <- subset(ELE4, subset=ELE4$Region_ELE4==7)
ELE4_r08 <- subset(ELE4, subset=ELE4$Region_ELE4==8)
ELE4_r09 <- subset(ELE4, subset=ELE4$Region_ELE4==9)
ELE4_r10 <- subset(ELE4, subset=ELE4$Region_ELE4==10)
ELE4_r11 <- subset(ELE4, subset=ELE4$Region_ELE4==11)
ELE4_r12 <- subset(ELE4, subset=ELE4$Region_ELE4==12)
ELE4_r13 <- subset(ELE4, subset=ELE4$Region_ELE4==13)
ELE4_r14 <- subset(ELE4, subset=ELE4$Region_ELE4==14)
ELE4_r15 <- subset(ELE4, subset=ELE4$Region_ELE4==15)

{% endhighlight %}








{% highlight r %}

#ELE4
#A Agricultura , Ganadería, Silvicultura y Pesca
#B Explotación de Minas y Canteras
#C Industrias Manufactureras
#X Suministro de Electricidad, Gas y Agua (Suministro de electricidad, gas, vapor y aire acondicionado - Suministro de agua; evacuación de aguas residuales, gestión de desechos y descontaminación)
#F Construcción
#G Comercio al por mayor y al por menor; reparación de vehículos automotores y motocicletas
#H Transporte y Almacenamiento
#I Actividades de alojamiento y de servicio de comidas
#J Información y Comunicaciones
#K Actividades financieras y de seguros
#M Actividades profesionales, científicas y técnicas
#Y Actividades de servicios (Actividades inmobiliarias - Actividades de servicios administrativos y de apoyo)
#Z Actividades artísticas, de entretenimiento y recreativas 

f <- ELE4

attach(f)
f$sector[CIIUfinal_ELE4=="A"] <- "Agricultura, Silvicultura y Pesca"
f$sector[CIIUfinal_ELE4=="B"] <- "Mineria"
f$sector[CIIUfinal_ELE4=="C"] <- "Manufactura"
f$sector[CIIUfinal_ELE4=="X"] <- "Electricidad, Gas y Agua"
f$sector[CIIUfinal_ELE4=="F"] <- "Construccion"
f$sector[CIIUfinal_ELE4=="G"] <- "Comercio"
f$sector[CIIUfinal_ELE4=="H"] <- "Transporte y Almacenamiento"
f$sector[CIIUfinal_ELE4=="I"] <- "Hoteleria"
f$sector[CIIUfinal_ELE4=="J"] <- "Informacion y Comunicaciones"
f$sector[CIIUfinal_ELE4=="K"] <- "Banca"
f$sector[CIIUfinal_ELE4=="M"] <- "Act. profesionales, científ. y téc."
f$sector[CIIUfinal_ELE4=="Y"] <- "Serv. inmobiliarios y admin."
f$sector[CIIUfinal_ELE4=="Z"] <- "Artisticas y recreativas"
detach(f)

sector_names <- c("Agricultura, Silvicultura y Pesca", 
"Mineria", 
"Manufactura",
"Electricidad, Gas y Agua",
"Construccion",
"Comercio",
"Transporte y Almacenamiento",
"Hoteleria",
"Informacion y Comunicaciones",
"Banca",
"Act. profesionales, científ. y téc.",
"Serv. inmobiliarios y admin.",
"Artisticas y recreativas",
"TOTAL")

f$LP <- log(f$LP)

attach(f)
f$LPcat[LP > 0   & LP<= 1] <- 1
f$LPcat[LP > 1   & LP<= 2] <- 2
f$LPcat[LP > 2   & LP<= 3] <- 3
f$LPcat[LP > 3   & LP<= 4] <- 4
f$LPcat[LP > 4   & LP<= 5] <- 5
f$LPcat[LP > 5   & LP<= 6] <- 6
f$LPcat[LP > 6   & LP<= 7] <- 7
f$LPcat[LP > 7   & LP<= 8] <- 8
f$LPcat[LP > 8   & LP<= 9] <- 9
f$LPcat[LP > 9   & LP<=10] <- 10
f$LPcat[LP > 10  & LP<=11] <- 11
f$LPcat[LP > 11  & LP<=12] <- 12
f$LPcat[LP > 12  & LP<=13] <- 13
f$LPcat[LP > 13  & LP<=14] <- 14
f$LPcat[LP > 14] <- 15
detach(f)

f$ventas <- f$Y2015 * f$FE_E 

f <- aggregate(f$ventas, by=list(f$sector, f$LPcat), FUN=sum, na.rm=TRUE)
f$FE <- f$x 
f$sector <- f$Group.1
f$LPcat <- f$Group.2
f <- f[c("sector", "LPcat", "FE")]

suma <- sum(f$FE)

f$FE_prop <- f$FE / suma

ggplot(f, aes(x=LPcat, y=FE_prop, fill=sector, order=sector)) + geom_bar(stat="identity") + theme(legend.position = "right") + xlab("Productividad Laboral (logaritmo)") + ylab("Proporción de empresas (ventas)") + ggtitle("Distribución de Empresas por su productividad laboral") + scale_y_continuous(labels = scales::percent_format())

{% endhighlight %}


<img src="/figs/2017-03-30-ele_prod/unnamed-chunk-2-1.png" width="500"/>